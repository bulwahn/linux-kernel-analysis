Analysis Report 0001
Warning Type and Explanation: Enum-Conversion , implicit conversion from enumeration type 'enum port' to different enumeration type 'enum intel_dpll_id' [-Wenum-conversion]
        enum intel_dpll_id pll_id = port;
Introducing Commit: 2952cd6fb4cc ("drm/i915: Let's use more enum intel_dpll_id pll_id.")
Version: 4.15 Stable
File Location: drm/i915/intel_ddi.c:1481:30
Solution Commit: bb911536f07e ("drm/i915: Eliminate pll->state usage from bxt_calc_pll_link()")

Manuel Assesment

static void bxt_ddi_clock_get(struct intel_encoder *encoder,
                                struct intel_crtc_state *pipe_config)
{       
        struct drm_i915_private *dev_priv = to_i915(encoder->base.dev);
        enum port port = intel_ddi_get_encoder_port(encoder);
        enum intel_dpll_id pll_id = port; //This line creates warning
        
        pipe_config->port_clock = bxt_calc_pll_link(dev_priv, pll_id);
        
        ddi_dotclock_get(pipe_config);
}

There is an implicit conversion problem between enum intel_dpll_id and enum port. To clearly understand this problem, we must look definition of enum port and enum intel_dpll_id:

enum intel_dpll_id
file: /drm/i915/intel_dpll_mgr.h:48
enum intel_dpll_id {
	/**
	 * @DPLL_ID_PRIVATE: non-shared dpll in use
	 */
	DPLL_ID_PRIVATE = -1,

	/**
	 * @DPLL_ID_PCH_PLL_A: DPLL A in ILK, SNB and IVB
	 */
	DPLL_ID_PCH_PLL_A = 0,
	/**
	 * @DPLL_ID_PCH_PLL_B: DPLL B in ILK, SNB and IVB
	 */
	DPLL_ID_PCH_PLL_B = 1,


	/**
	 * @DPLL_ID_WRPLL1: HSW and BDW WRPLL1
	 */
	DPLL_ID_WRPLL1 = 0,
	/**
	 * @DPLL_ID_WRPLL2: HSW and BDW WRPLL2
	 */
	DPLL_ID_WRPLL2 = 1,
	/**
	 * @DPLL_ID_SPLL: HSW and BDW SPLL
	 */
	DPLL_ID_SPLL = 2,
	/**
	 * @DPLL_ID_LCPLL_810: HSW and BDW 0.81 GHz LCPLL
	 */
	DPLL_ID_LCPLL_810 = 3,
	/**
	 * @DPLL_ID_LCPLL_1350: HSW and BDW 1.35 GHz LCPLL
	 */
	DPLL_ID_LCPLL_1350 = 4,
	/**
	 * @DPLL_ID_LCPLL_2700: HSW and BDW 2.7 GHz LCPLL
	 */
	DPLL_ID_LCPLL_2700 = 5,


	/**
	 * @DPLL_ID_SKL_DPLL0: SKL and later DPLL0
	 */
	DPLL_ID_SKL_DPLL0 = 0,
	/**
	 * @DPLL_ID_SKL_DPLL1: SKL and later DPLL1
	 */
	DPLL_ID_SKL_DPLL1 = 1,
	/**
	 * @DPLL_ID_SKL_DPLL2: SKL and later DPLL2
	 */
	DPLL_ID_SKL_DPLL2 = 2,
	/**
	 * @DPLL_ID_SKL_DPLL3: SKL and later DPLL3
	 */
	DPLL_ID_SKL_DPLL3 = 3,
};

enum port
file: /drm/i915/i915_drv.h:342
enum port {
	PORT_NONE = -1,
	PORT_A = 0,
	PORT_B,
	PORT_C,
	PORT_D,
	PORT_E,
	I915_MAX_PORTS
};

Investigation of solution commit:
Commit bb911536f07e modified the part of function , which creates warning as:
-       struct drm_i915_private *dev_priv = to_i915(encoder->base.dev);
-       enum port port = encoder->port;
-       enum intel_dpll_id pll_id = port;
-
-       pipe_config->port_clock = bxt_calc_pll_link(dev_priv, pll_id);
+       pipe_config->port_clock = bxt_calc_pll_link(pipe_config);

Since there isn't any conversion between port and intel_dpll_id , the enum-conversion warning is  disappeared.






